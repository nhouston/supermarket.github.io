<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Basket UK</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Clean, Canvas-Free CSS */
        :root {
            --bg: #f1f5f9; --surface: #ffffff; --primary: #3b82f6;
            --text: #1e293b; --border: #e2e8f0;
            --c-sainsburys: #f06c00; --c-tesco: #00539f; --c-asda: #78be20;
            --c-aldi: #001d6c; --c-morrisons: #005e35;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 40px 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        
        h1 { font-size: 2.5rem; font-weight: 900; text-align: center; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #64748b; margin-bottom: 40px; }

        .input-group { display: flex; gap: 10px; margin-bottom: 30px; max-width: 500px; margin-left: auto; margin-right: auto; }
        input { flex: 1; padding: 15px; border-radius: 12px; border: 1px solid var(--border); font-size: 1rem; }
        button.add { background: var(--primary); color: white; border: none; padding: 0 25px; border-radius: 12px; font-weight: 600; cursor: pointer; }
        
        /* Chips */
        .chips { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 40px; }
        .chip { background: white; padding: 8px 16px; border-radius: 20px; border: 1px solid var(--border); display: flex; align-items: center; gap: 8px; font-weight: 500; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .chip button { background: #e2e8f0; color: #ef4444; border: none; width: 20px; height: 20px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* Cards */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 16px; border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); position: relative; }
        .card.winner { border: 2px solid #fbbf24; background: #fffbeb; order: -1; }
        .winner-badge { position: absolute; top: -10px; right: 20px; background: #fbbf24; color: #92400e; padding: 4px 12px; border-radius: 10px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; }
        
        .store-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border); }
        .store-name { font-weight: 800; font-size: 1.2rem; }
        .total { font-size: 1.5rem; font-weight: 800; }
        
        .brand-Sainsburys { color: var(--c-sainsburys); }
        .brand-Tesco { color: var(--c-tesco); }
        .brand-Asda { color: var(--c-asda); }
        .brand-Aldi { color: var(--c-aldi); }
        .brand-Morrisons { color: var(--c-morrisons); }

        .missing { font-size: 0.85rem; color: #ef4444; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Basket Check UK</h1>
    <div class="subtitle" id="status">Loading prices...</div>

    <div class="input-group">
        <input type="text" id="input" placeholder="Add item (e.g. Saffron)..." onkeypress="handleKey(event)">
        <button class="add" onclick="addItem()">Add</button>
    </div>

    <div id="chips" class="chips"></div>
    <div id="grid" class="grid"></div>
</div>

<script>
    let priceData = {};
    let basket = JSON.parse(localStorage.getItem('myBasket')) || []; // Load from Browser Memory

    async function init() {
        renderBasket();
        try {
            const res = await fetch('prices.json');
            priceData = await res.json();
            document.getElementById('status').innerText = `Prices updated: ${priceData.lastUpdated}`;
            renderComparison();
        } catch (e) {
            document.getElementById('status').innerText = "Using Example Data (Preview)";
            priceData = { prices: { "Tesco": {"Milk": 1.20}, "Asda": {"Milk": 1.15} } }; // Fallback
        }
    }

    function handleKey(e) { if(e.key === 'Enter') addItem(); }

    function addItem() {
        const val = document.getElementById('input').value.trim();
        if(!val) return;
        const item = val.charAt(0).toUpperCase() + val.slice(1).toLowerCase();
        if(!basket.includes(item)) {
            basket.push(item);
            save();
            renderBasket();
            renderComparison();
        }
        document.getElementById('input').value = '';
    }

    function removeItem(item) {
        basket = basket.filter(i => i !== item);
        save();
        renderBasket();
        renderComparison();
    }

    function save() {
        localStorage.setItem('myBasket', JSON.stringify(basket));
    }

    function renderBasket() {
        document.getElementById('chips').innerHTML = basket.map(item => `
            <div class="chip">${item} <button onclick="removeItem('${item}')">✕</button></div>
        `).join('');
    }

    function renderComparison() {
        if(basket.length === 0 || !priceData.prices) return;
        
        const results = Object.entries(priceData.prices).map(([store, inventory]) => {
            let total = 0;
            let missing = [];
            
            basket.forEach(item => {
                // Simple exact or fuzzy match
                if (inventory[item]) {
                    total += inventory[item];
                } else {
                    const key = Object.keys(inventory).find(k => k.toLowerCase().includes(item.toLowerCase()));
                    if(key) total += inventory[key];
                    else missing.push(item);
                }
            });
            return { store, total, missing };
        }).sort((a, b) => a.total - b.total);

        document.getElementById('grid').innerHTML = results.map((res, idx) => `
            <div class="card ${idx === 0 ? 'winner' : ''}">
                ${idx === 0 ? '<div class="winner-badge">Best Value</div>' : ''}
                <div class="store-header">
                    <span class="store-name brand-${res.store}">${res.store}</span>
                    <span class="total">£${res.total.toFixed(2)}</span>
                </div>
                ${res.missing.length > 0 
                    ? `<div class="missing">⚠️ Not tracked: ${res.missing.join(', ')}</div>` 
                    : '<div style="color:green;font-size:0.9rem">✓ All found</div>'}
            </div>
        `).join('');
    }

    init();
</script>
</body>
</html>
